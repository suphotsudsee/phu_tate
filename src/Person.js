import React, { useEffect, useState } from "react";
import "./Mycss.css";
import { useLocation } from "react-router-dom";
import BarChart from "./BarChart";

function Person() {
  const { state } = useLocation();

  // ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
  if (!state || !state.allresult || state.allresult.length === 0) {
    return <div>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à</div>;
  }

  // ‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
  const filteredData = state.allresult
    .map((item) => ({
      date: new Date(
        new Date(item.DATE_SERV).toLocaleString("en-US", {
          timeZone: "Asia/Bangkok",
        })
      )
        .toISOString()
        .split("T")[0], // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô YYYY-MM-DD ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏ã‡∏ô‡πÄ‡∏õ‡πá‡∏ô Asia/Bangkok
      labResult: parseFloat(item.LABRESULT),
      hospname: item.hospname,
    }))
    .sort((a, b) => new Date(a.date) - new Date(b.date)) // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
    .slice(-10); // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏Ñ‡πà 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢

  // ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ó‡∏µ‡πà 9 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö 10 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
  const latestData = filteredData[filteredData.length - 1];
  const d = new Date(latestData.date);
  const dresult = d.toLocaleDateString("th-TH", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });

  return (
    <>
    <div className="container">
      <div className="header-text">{latestData.labResult}</div>
      <div >‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à : {dresult}</div>
      <div >{latestData.hospname}</div>
      <div className="main-title">‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î</div>

      <div className="result-number">70-100</div>
      <div className="description">mg/dL</div>

      <div className="alert-section">
        <div className="alert-text text-center">
          <p>&lt; 70 ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ï‡πà‡∏≥ ‡∏£‡∏∞‡∏ß‡∏±‡∏á !! ‡∏ß‡∏π‡∏ö</p>
          <p>&gt; 100 ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ñ‡∏∏‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£</p>
          <p>&gt; 126 ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞</p>
        </div>
      </div>

      <div className="suggestions">
        <h5 className="text-center">‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏™‡∏π‡∏á‡∏ó‡∏≥‡πÑ‡∏á‡∏î‡∏µ ?</h5>
        <div className="suggestion-item">
          <span className="icon">üíñ</span> ‡∏•‡∏î‡πÅ‡∏õ‡πâ‡∏á ‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏• ‡∏Ç‡∏≠‡∏á‡∏´‡∏ß‡∏≤‡∏ô ‡∏ô‡πâ‡∏≥‡∏≠‡∏±‡∏î‡∏•‡∏° ‡∏ô‡πâ‡∏≥‡∏´‡∏ß‡∏≤‡∏ô
        </div>
        <div className="suggestion-item">
          <span className="icon">üíñ</span> ‡∏ó‡∏≤‡∏ô‡∏°‡∏∑‡πâ‡∏≠‡πÄ‡∏¢‡πá‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à‡∏ã‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô 6 ‡πÇ‡∏°‡∏á
        </div>
        <div className="suggestion-item">
          <span className="icon">üíñ</span> ‡∏•‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡πÅ‡∏≠‡∏•‡∏Å‡∏≠‡∏Æ‡∏≠‡∏•‡πå ‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà
        </div>
        <div className="suggestion-item">
          <span className="icon">üíñ</span> ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ / ‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠
        </div>
      </div>
    </div>
      <div>
        <h1>‡∏ú‡∏•‡∏ï‡∏£‡∏ß‡∏à</h1>
        <BarChart data={filteredData}/>
      </div>
</>
  );
}

export default Person;
